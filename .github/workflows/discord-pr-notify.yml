name: Discord PR Notifications

on:
  pull_request:
    types: [review_requested, closed]
  pull_request_review:
    types: [submitted]

jobs:
  review-request-notify:
    if: github.event.action == 'review_requested'
    runs-on: ubuntu-latest
    steps:
      - name: Send Review Request Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
          REQUESTED_REVIEWER: ${{ github.event.requested_reviewer.login }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
        run: |
          case "$REQUESTED_REVIEWER" in
            "chanho0908")
              DISCORD_MENTION="<@1451876971540774912>"
              ;;
            "dogmania")
              DISCORD_MENTION="<@951268632770531399>"
              ;;
            *)
              DISCORD_MENTION="@$REQUESTED_REVIEWER"
              ;;
          esac

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{\"content\": \"$DISCORD_MENTION ë¦¬ë·° ìš”ì²­ì´ ì™”ì–´ìš”! ğŸ‘€\", \"embeds\": [{\"title\": \"#$PR_NUMBER $PR_TITLE\", \"url\": \"$PR_URL\", \"color\": 5814783}]}" \
               $DISCORD_WEBHOOK

  review-completed-notify:
    if: github.event_name == 'pull_request_review'
    runs-on: ubuntu-latest
    steps:
      - name: Send Review Completed Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
          REVIEWER: ${{ github.event.review.user.login }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
          AUTHOR: ${{ github.event.pull_request.user.login }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
          REVIEW_STATE: ${{ github.event.review.state }}
        run: |
          case "$AUTHOR" in
            "chanho0908")
              AUTHOR_MENTION="<@1451876971540774912>"
              ;;
            "dogmania")
              AUTHOR_MENTION="<@951268632770531399>"
              ;;
            *)
              AUTHOR_MENTION="@$AUTHOR"
              ;;
          esac

          case "$REVIEW_STATE" in
            "approved")
              MESSAGE="âœ… ë¦¬ë·°ê°€ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!"
              COLOR=3066993
              EMOJI="âœ…"
              ;;
            "changes_requested")
              MESSAGE="ğŸ”§ ìˆ˜ì • ìš”ì²­ì´ ìˆìŠµë‹ˆë‹¤"
              COLOR=15158332
              EMOJI="ğŸ”§"
              ;;
            "commented")
              MESSAGE="ğŸ’¬ ë¦¬ë·° ì½”ë©˜íŠ¸ê°€ ë‹¬ë ¸ìŠµë‹ˆë‹¤"
              COLOR=10181046
              EMOJI="ğŸ’¬"
              ;;
            *)
              MESSAGE="ë¦¬ë·°ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤"
              COLOR=5814783
              EMOJI="ğŸ“"
              ;;
          esac

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{\"content\": \"$AUTHOR_MENTION $MESSAGE\", \"embeds\": [{\"title\": \"$EMOJI #$PR_NUMBER $PR_TITLE\", \"url\": \"$PR_URL\", \"color\": $COLOR, \"fields\": [{\"name\": \"PR ì‘ì„±ì\", \"value\": \"$AUTHOR\", \"inline\": true}, {\"name\": \"ë¦¬ë·°ì–´\", \"value\": \"$REVIEWER\", \"inline\": true}]}]}" \
               $DISCORD_WEBHOOK

  merge-notify:
    if: github.event.pull_request.merged == true
    runs-on: ubuntu-latest
    steps:
      - name: Send Merge Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
          PR_TITLE: ${{ github.event.pull_request.title }}
          PR_URL: ${{ github.event.pull_request.html_url }}
          AUTHOR: ${{ github.event.pull_request.user.login }}
          MERGER: ${{ github.event.pull_request.merged_by.login }}
          PR_NUMBER: ${{ github.event.pull_request.number }}
          BASE_BRANCH: ${{ github.event.pull_request.base.ref }}
        run: |
          case "$AUTHOR" in
            "chanho0908")
              AUTHOR_MENTION="<@1451876971540774912>"
              ;;
            "dogmania")
              AUTHOR_MENTION="<@951268632770531399>"
              ;;
            *)
              AUTHOR_MENTION="@$AUTHOR"
              ;;
          esac

          curl -H "Content-Type: application/json" \
               -X POST \
               -d "{\"content\": \"ğŸ‰ PRì´ ë¨¸ì§€ë˜ì—ˆìŠµë‹ˆë‹¤! $AUTHOR_MENTION\", \"embeds\": [{\"title\": \"#$PR_NUMBER $PR_TITLE\", \"url\": \"$PR_URL\", \"color\": 3066993, \"fields\": [{\"name\": \"ì‘ì„±ì\", \"value\": \"$AUTHOR\", \"inline\": true}, {\"name\": \"ë¨¸ì§€í•œ ì‚¬ëŒ\", \"value\": \"$MERGER\", \"inline\": true}, {\"name\": \"ë¸Œëœì¹˜\", \"value\": \"$BASE_BRANCH\", \"inline\": true}]}]}" \
               $DISCORD_WEBHOOK
